# viso2

[【泡泡机器人原创专栏-libviso】libviso中姿态计算详解 ](https://mp.weixin.qq.com/s/lCZ79-mZQPSWhTEypRIWjw)


        ROS Stack containing a wrapper for libviso2, a visual odometry library. 
        
        http://www.ros.org/wiki/viso2 for the list of contained packages.


        从多个二维图片中重建3D影像是机器视觉必不可少的部分，这篇论文【1】提出的就是做3D重建的工作。
        这篇论文提出了一种巧妙的实时的方法做3D地图重建——使用稀疏特征和视觉里程计相结合的方法。
        这种方法包含了立体匹配和创建点云。用这种方法计算出来的视觉里程计是当年11年最好的。
        该法可以每秒执行25f，同时建立3~4fps的深度地图，可以用于实时3d重建（这个用的是11年的处理器）

        本文的贡献在于：
        1、使用几千个特征匹配实时计算了场景流；
        2、简单但是又鲁棒的视觉里程计被提出；
        3、使用ego-motion，集合从LIBELAS的立体测量，解决了匹配连接问题。

#  A、特征匹配

        使用blob和角点算子对输入的四幅图片（左右两个方向以及连续的）进行处理；
        然后使用NMinimumS和NMaximumM就可以得到blob max, blob min, corner max, corner min。
        然后对这四类进行匹配。进行两个特征点之间的匹配的时候，不是使用RANSAC这样乱匹配，
        而是假设摄像头平缓移动，然后在该特征点的11x11一个区域计算水平和
        垂直的Sobel算子计算（用水平再加垂直方向，可以使计算复杂度从O(n2

        )变成O(n)）。计算Sobel算子，然后计算这个区域的SSD。为了加快速度，
        使用了特殊位置的Sobel算子，并且只用了8bits精度。

        这是指特征点的匹配计算，具体如何找到对应关系呢？
        从当前帧左边的图片出发，把特征点与左边前一帧图片在MxM的范围比较。
        然后左边前一帧与右边前一帧，右边前一帧与右边当前帧，然后左右边当前帧。
        对这一圈都匹配的时候就是用对极几何计算，容错在一个像素。
        噪点会通过2d Delaunay triangulation剔除。保留至少有两个邻近匹配的特征点。

        总结一下：libviso通过corner,chessboard两种kernel的响应以及非极大值抑制的方式提取特征，
        并用sobel算子与原图卷积的结果作为特征点的描述子。
        
# B、ego-motion估计

        使用刚才得到的循环特征来逆投影计算最小误差来得到摄像头的位姿以及用卡尔曼滤波计算速度。

        1、使用桶排序减少特征点的数目，并且使特征点均匀分布，最后保留200~500个特征点；

        2、接着把3d特征点投影到2d位置，使用摄像头内外参，然后最小化误差。
        
        使用牛顿迭代或者是LM方法计算即可。

        为了详细说明这个问题，我引用我的同学对此的介绍【2】或者看这篇论文【3】：
        位姿的计算使用6个变量计算：3个选择分量+3个偏移分量。 
